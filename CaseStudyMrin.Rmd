#case study 1


```{r}
library(tidyverse)
library(mice)
library(ggplot2)
library(stringr)
library(class)
library(caret)
```

```{r}
beers = read.csv("Beers.csv")
breweries = read.csv("Breweries.csv")
head(beers)
head(breweries)
```


#question 1: how many breweries are present in each state?

```{r}
state_breweries <- breweries %>%
  group_by(State) %>%
  tally()
head(state_breweries)
state_breweries %>%
  ggplot(aes(x=State, y=n)) +
  geom_bar(stat = "identity")
```

#Merging Beer and Breweries data
```{r}
breweries1 <- merge(beers,breweries,by.x="Beer_ID",by.y="Brew_ID")
head(breweries1,6)
tail(breweries1,6)
```
#Missing Values
```{r}

colSums(is.na(breweries1))

#breweries_complete <- mice(breweries1,m=5,meth = "norm.predict")
breweries1$ABV[is.na(breweries1$ABV)] <- mean(breweries1$ABV, na.rm = TRUE)
breweries1$IBU[is.na(breweries1$IBU)] <- mean(breweries1$IBU, na.rm = TRUE)

colSums(is.na(breweries1))
```
#Scatterplot of IBU Vs. ABV
```{r}
breweries1 %>% ggplot(aes(x=ABV,y=IBU)) + geom_point()+geom_smooth(method=lm) + labs(x = "Alcohol By Volume (ABV)",y = "International Bitternes Unit (IBU)", title = "Relationship Between ABV and IBU")

# Judging by the scatterplot and the regression line there seems to be a positive correlation between ABV and IBU.  So that means there is a positive relationship betwen ABV and IBU so as ABV increases, so does IBU. 
```
#Knn Part 1: Configuring the data to identify which Style is IPA or Ale

```{r}
breweriesKnn <- breweries1
for (i in 1: nlevels(breweriesKnn$Style))
{
  if (grepl("IPA",levels(breweriesKnn$Style)[i]) == TRUE)
  {
    levels(breweriesKnn$Style)[i] = "IPA"
  }
  
}
for (j in 1: nlevels(breweriesKnn$Style))
{
  if (grepl("Ale",levels(breweriesKnn$Style)[j]) == TRUE)
  {
    levels(breweriesKnn$Style)[j] = "Ale"
  }
  
}
for (d in 1: nlevels(breweriesKnn$Style))
{
  if (grepl("American Blonde Ale",levels(breweriesKnn$Style)[d]) == TRUE)
  {
    levels(breweriesKnn$Style)[d] = "Ale"
  }
  if (grepl("English Dark Mild Ale",levels(breweriesKnn$Style)[d]) == TRUE)
  {
    levels(breweriesKnn$Style)[d] = "Ale"
  }
  if (grepl("Scottish Ale",levels(breweriesKnn$Style)[d]) == TRUE)
  {
    levels(breweriesKnn$Style)[d] = "Ale"
  }
  if (grepl("Belgian Pale Ale",levels(breweriesKnn$Style)[d]) == TRUE)
  {
    levels(breweriesKnn$Style)[d] = "Ale"
  }
  if (grepl("Belgian Strong Pale Ale",levels(breweriesKnn$Style)[d]) == TRUE)
  {
    levels(breweriesKnn$Style)[d] = "Ale"
  }
  if (grepl("American Dark Wheat Ale",levels(breweriesKnn$Style)[d]) == TRUE)
  {
    levels(breweriesKnn$Style)[d] = "Ale"
  }
  if (grepl("English Pale Mild Ale",levels(breweriesKnn$Style)[d]) == TRUE)
  {
    levels(breweriesKnn$Style)[d] = "Ale"
  }
  if (grepl("American Wild Ale",levels(breweriesKnn$Style)[d]) == TRUE)
  {
    levels(breweriesKnn$Style)[d] = "Ale"
  }
  
}
```

#Knn Part 2: Using Knn model to predict Style of Beer
```{r}
breweriesKnn<-breweriesKnn %>% filter(Style=="IPA"|Style=="Ale")%>% droplevels()
set.seed(6)
splitPerc = .7
trainIndices = sample(1:dim(breweriesKnn)[1],round(splitPerc * dim(breweriesKnn)[1]))
train = breweriesKnn[trainIndices,]
test = breweriesKnn[-trainIndices,]
accs = data.frame(accuracy = numeric(100), k = numeric(100))

for(i in 1:100)
{
styles = knn.cv(breweriesKnn[,c(3,4)],breweriesKnn$Style, prob = TRUE, k = i)
  table(breweriesKnn$Style,styles)
  CM = confusionMatrix(table(breweriesKnn$Style,styles))
  accs$accuracy[i] = CM$overall[1]
  accs$k[i] = i
}

plot(accs$k,accs$accuracy, type = "l", xlab = "k")
accu = accs$accuracy
max(accu)



```


```{r}
